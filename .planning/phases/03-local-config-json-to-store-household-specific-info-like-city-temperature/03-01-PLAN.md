---
phase: 03-local-config-json-to-store-household-specific-info-like-city-temperature
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - local_config.json
  - tasks/local-config.js
  - tasks/weather/helpers/get-weather.js
  - tasks/weather/config.js
  - tasks/cache.js
autonomous: true
requirements: []

must_haves:
  truths:
    - "Household city, timezone, and temperature units are defined in a single config file"
    - "Weather task reads default location and units from local_config.json instead of hardcoded values"
    - "Cache daily-reset timezone reads from local_config.json instead of hardcoded America/Los_Angeles"
    - "Changing local_config.json values changes weather defaults and cache timezone without code edits"
  artifacts:
    - path: "local_config.json"
      provides: "Household preferences: city, timezone, temperature units"
      contains: "Seattle"
    - path: "tasks/local-config.js"
      provides: "Config loader with sensible defaults"
      exports: ["loadLocalConfig"]
  key_links:
    - from: "tasks/weather/helpers/get-weather.js"
      to: "tasks/local-config.js"
      via: "require and loadLocalConfig()"
      pattern: "require.*local-config"
    - from: "tasks/cache.js"
      to: "tasks/local-config.js"
      via: "require and loadLocalConfig()"
      pattern: "require.*local-config"
---

<objective>
Create local_config.json at workspace root with household-specific settings (city, timezone, temperature units) and a loader module. Wire into weather task and cache so they read from config instead of hardcoded values.

Purpose: Eliminate hardcoded household-specific values scattered across the tasks/ subsystem. A single config file makes it trivial to adapt the assistant for a different household.
Output: local_config.json, tasks/local-config.js loader, updated weather + cache modules.
</objective>

<execution_context>
@/Users/greg/.claude/get-shit-done/workflows/execute-plan.md
@/Users/greg/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@tasks/weather/helpers/get-weather.js
@tasks/weather/config.js
@tasks/cache.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create local_config.json and loader module</name>
  <files>local_config.json, tasks/local-config.js</files>
  <action>
Create `local_config.json` at workspace root with this exact structure:

```json
{
  "city": "Seattle,WA,US",
  "timezone": "America/Los_Angeles",
  "units": "imperial"
}
```

Create `tasks/local-config.js` as a loader module:
- Export a `loadLocalConfig()` function
- Reads `local_config.json` from workspace root (path.join(__dirname, '..', 'local_config.json'))
- Uses `fs.readFileSync` + `JSON.parse` (synchronous, like loadConfig in calendar.js)
- On file-not-found or parse error: return hardcoded defaults { city: 'Seattle,WA,US', timezone: 'America/Los_Angeles', units: 'imperial' }
- This means the system works identically if the file is missing -- graceful degradation
- Follow the factory-function-over-classes convention (no class, just a plain function)
- Keep it simple: ~20 lines max
  </action>
  <verify>
Run `node -e "const c = require('./tasks/local-config'); console.log(JSON.stringify(c.loadLocalConfig()))"` from workspace root.
Should print: {"city":"Seattle,WA,US","timezone":"America/Los_Angeles","units":"imperial"}
  </verify>
  <done>local_config.json exists with city/timezone/units. Loader reads it and returns correct values. Loader returns defaults gracefully if file is missing.</done>
</task>

<task type="auto">
  <name>Task 2: Wire weather task and cache to use local config</name>
  <files>tasks/weather/helpers/get-weather.js, tasks/weather/config.js, tasks/cache.js</files>
  <action>
**tasks/weather/helpers/get-weather.js:**
- Add `const { loadLocalConfig } = require('../../local-config');` at top (after existing requires)
- Remove the two hardcoded constants: `const DEFAULT_LOCATION = 'Seattle,WA,US';` and `const DEFAULT_UNITS = 'imperial';`
- In `getWeather()`, load config at function start: `const config = loadLocalConfig();`
- Replace `parameters.location || DEFAULT_LOCATION` with `parameters.location || config.city`
- Replace `parameters.units || DEFAULT_UNITS` with `parameters.units || config.units`

**tasks/weather/config.js:**
- Add `const { loadLocalConfig } = require('../local-config');` at top
- In keyStrategy function, replace `(params.location || 'Seattle,WA,US')` with `(params.location || loadLocalConfig().city)`
- Replace `params.units || 'imperial'` with `params.units || loadLocalConfig().units`

**tasks/cache.js:**
- Add `const { loadLocalConfig } = require('./local-config');` at top (after existing requires)
- In `todayPacific()`, replace hardcoded `'America/Los_Angeles'` with `loadLocalConfig().timezone`

Do NOT touch calendar/calendar.js -- it has its own config mechanism via calendar/config.json.
Do NOT touch tasks/calendar/helpers/set-calendar-item.js -- it already reads timezone from calendar/config.json via loadConfig().
  </action>
  <verify>
Run `node -e "const c = require('./tasks/cache'); console.log('cache ok')"` -- should print "cache ok" without errors.
Run `node -e "const w = require('./tasks/weather/config'); console.log(w.task, Object.keys(w.intents))"` -- should print "weather ['get']".
Run `node -e "const { loadLocalConfig } = require('./tasks/local-config'); const lc = loadLocalConfig(); console.log(lc.city, lc.timezone, lc.units)"` -- should print "Seattle,WA,US America/Los_Angeles imperial".
  </verify>
  <done>Weather task defaults come from local_config.json. Cache timezone comes from local_config.json. No hardcoded household-specific values remain in tasks/weather/ or tasks/cache.js.</done>
</task>

</tasks>

<verification>
1. `node -e "console.log(JSON.parse(require('fs').readFileSync('local_config.json','utf8')))"` -- prints config object
2. `grep -r "Seattle" tasks/` -- should return zero matches (all replaced by config.city)
3. `grep "America/Los_Angeles" tasks/cache.js` -- should return zero matches
4. `node tasks/index.js "weather get"` -- returns structured LLMPayload (error about API key is fine, proves config loads)
</verification>

<success_criteria>
- local_config.json exists at workspace root with city, timezone, units
- tasks/local-config.js exports loadLocalConfig() with graceful defaults
- No hardcoded 'Seattle,WA,US' or 'imperial' in tasks/weather/
- No hardcoded 'America/Los_Angeles' in tasks/cache.js
- All existing task system functionality unchanged (weather, cache, calendar)
</success_criteria>

<output>
After completion, create `.planning/phases/03-local-config-json-to-store-household-specific-info-like-city-temperature/03-01-SUMMARY.md`
</output>
