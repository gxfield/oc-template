---
phase: 01-todoist-fix-media-server-research
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - credentials.json
  - TOOLS.md
autonomous: false
user_setup:
  - service: todoist
    why: "Todoist API key and project IDs required for authentication"
    env_vars:
      - name: todoist_api_key
        source: "Todoist Settings > Integrations > Developer > API token"
      - name: todoist_projects.todos
        source: "Todoist web app > open Todos project > project ID from URL"
      - name: todoist_projects.shopping
        source: "Todoist web app > open Shopping project > project ID from URL"

must_haves:
  truths:
    - "Running `node tasks/index.js 'todoist get project=todos'` returns a valid JSON response with tasks array"
    - "Running `node tasks/index.js 'todoist add project=todos content=Test task'` creates a task and returns created:true"
    - "Running `node tasks/index.js 'todoist done taskId=ID'` completes the test task"
    - "All three Todoist intents (get, add, done) work for both todos and shopping projects"
  artifacts:
    - path: "credentials.json"
      provides: "Todoist API key and project IDs"
      contains: "todoist_api_key"
  key_links:
    - from: "tasks/todoist/helpers/todoist-api.js"
      to: "credentials.json"
      via: "fs.readFileSync with 3-level path traversal"
      pattern: "path.join.*credentials\\.json"
---

<objective>
Fix the Todoist integration by creating credentials.json with the user's Todoist API key and project IDs, then verify all three intents (get, add, done) work end-to-end.

Purpose: The Todoist task code is already correct and complete -- it just fails because credentials.json doesn't exist. This is the primary deliverable of Phase 1.
Output: Working Todoist integration verified with real API calls.
</objective>

<execution_context>
@/Users/greg/.claude/get-shit-done/workflows/execute-plan.md
@/Users/greg/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-todoist-fix-media-server-research/01-RESEARCH.md
@credentials.json.example
@tasks/todoist/config.js
@tasks/todoist/helpers/todoist-api.js
@tasks/todoist/helpers/fetch-tasks.js
@tasks/todoist/helpers/create-task.js
@tasks/todoist/helpers/complete-task.js
@setup.sh
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 1: Create credentials.json with Todoist API key and project IDs</name>
  <action>
The Todoist code works correctly but credentials.json is missing. The user needs to provide their Todoist API key and project IDs.

Steps for the user:
1. Run `./setup.sh` from the workspace root to create credentials.json from the template
2. Get your Todoist API token: Todoist Settings > Integrations > Developer > API token
3. Get project IDs: Open each project in Todoist web app, the project ID is in the URL (e.g., `https://app.todoist.com/app/project/XXXXXXXX` -- the number is the project ID)
4. Edit `credentials.json` and fill in:
   - `todoist_api_key`: Your API token from step 2
   - `todoist_projects.todos`: Project ID for your Todos project
   - `todoist_projects.shopping`: Project ID for your Shopping project

NOTE: credentials.json is gitignored (correctly) so it won't be committed.
  </action>
  <verify>Run `node tasks/index.js "todoist get project=todos"` -- should return JSON with tasks array instead of the "todoist_api_key not found" error.</verify>
  <done>credentials.json exists with valid todoist_api_key and todoist_projects.todos and todoist_projects.shopping values.</done>
</task>

<task type="auto">
  <name>Task 2: Verify all Todoist intents end-to-end and clean up</name>
  <files>TOOLS.md</files>
  <action>
After the user has populated credentials.json, verify all three Todoist intents work:

1. **Test GET (todos):** Run `node tasks/index.js "todoist get project=todos"` -- expect JSON with `tasks` array and `count`
2. **Test GET (shopping):** Run `node tasks/index.js "todoist get project=shopping"` -- expect JSON with `tasks` array and `count`
3. **Test ADD:** Run `node tasks/index.js "todoist add project=todos content=Test task from assistant"` -- expect `created: true` with task object containing `id`
4. **Test DONE:** Using the task ID from step 3, run `node tasks/index.js "todoist done taskId=TASK_ID"` -- expect `completed: true`
5. **Verify cleanup:** Run `node tasks/index.js "todoist get project=todos"` again to confirm the test task is gone

If any step fails, diagnose the error:
- 401/403: API key is wrong or expired
- "Unknown project": Project ID is wrong in credentials.json
- "todoist_api_key not found": credentials.json is missing or malformed
- Network error: Check internet connectivity

After successful verification, review TOOLS.md to ensure the Todoist commands section is accurate and complete. The existing TOOLS.md documentation (lines ~147-190) already documents Todoist correctly. No changes needed unless something is inaccurate.
  </action>
  <verify>All 5 verification steps above pass without errors. TOOLS.md Todoist section is accurate.</verify>
  <done>All three Todoist intents (get, add, done) verified working with real API calls for both todos and shopping projects.</done>
</task>

</tasks>

<verification>
- `node tasks/index.js "todoist get project=todos"` returns valid response
- `node tasks/index.js "todoist get project=shopping"` returns valid response
- `node tasks/index.js "todoist add project=todos content=Verification test"` creates task
- `node tasks/index.js "todoist done taskId=ID"` completes the created task
- No code changes were needed (the fix was configuration only)
</verification>

<success_criteria>
Todoist integration works end-to-end: the agent can list, add, and complete tasks in both the todos and shopping Todoist projects via the task orchestrator CLI.
</success_criteria>

<output>
After completion, create `.planning/phases/01-todoist-fix-media-server-research/01-01-SUMMARY.md`
</output>
