---
phase: 03-meal-planning
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - TOOLS.md
  - household/meals/this-week.md
autonomous: true

must_haves:
  truths:
    - "User can say 'set Monday dinner to lasagna' and the agent knows exactly how to update this-week.md"
    - "User can say 'what's for dinner tonight' and the agent knows how to look up today's meal"
    - "User can say 'make a shopping list from the meal plan' and the agent knows how to extract ingredients"
    - "TOOLS.md documents all meal planning triggers with exact parsing examples"
  artifacts:
    - path: "TOOLS.md"
      provides: "Meal Planning command handler section with trigger phrases, parsing examples, DO/DO NOT table"
      contains: "## Meal Planning"
    - path: "household/meals/this-week.md"
      provides: "Structured weekly meal plan with format header supporting ingredient extraction"
      contains: "FORMAT:"
  key_links:
    - from: "TOOLS.md Meal Planning section"
      to: "household/meals/this-week.md"
      via: "file path reference and format documentation"
      pattern: "household/meals/this-week.md"
---

<objective>
Add comprehensive Meal Planning command handlers to TOOLS.md and refine the this-week.md format header.

Purpose: Enable cheap LLMs to reliably handle meal planning commands -- setting weekly dinners, querying tonight's meal, and generating shopping lists from the plan. This follows the same documentation pattern established in phases 1-2 for calendar, todos, shopping, and notes.

Output: Expanded TOOLS.md with Meal Planning section; refined this-week.md format header.
</objective>

<execution_context>
@/Users/greg/.claude/get-shit-done/workflows/execute-plan.md
@/Users/greg/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@TOOLS.md
@household/meals/this-week.md
@household/shopping.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Meal Planning command handler section to TOOLS.md</name>
  <files>TOOLS.md</files>
  <action>
Add a new "## Meal Planning" section to TOOLS.md. Place it AFTER the "Quick Capture" section (line ~293) and BEFORE "Edge Cases for Telegram Command Parsing" (line ~296). This follows the established pattern of feature sections before edge cases.

The section must include:

**1. Trigger Phrase Table:**

| Trigger Pattern | Action |
|---|---|
| "set Monday to lasagna", "Monday dinner: lasagna" | Update this-week.md for that day |
| "set this week's meals", "meal plan for the week" | Update multiple days in this-week.md |
| "what's for dinner", "what's for dinner tonight", "dinner tonight" | Look up today's meal |
| "what's for dinner tomorrow", "dinner tomorrow" | Look up tomorrow's meal |
| "what are the meals this week", "show meal plan" | Show full week's plan |
| "shopping list from meals", "what do I need for this week's meals" | Generate ingredient list from meal plan |

**2. Parsing Rules for Setting Meals:**
- Get the target day name (must be full: Monday, Tuesday, etc.)
- Read household/meals/this-week.md
- Find the line starting with "- {Day}:" and replace the meal description
- Write the complete file back (preserve all 7 days)
- If user sets multiple days at once, update all specified lines

**3. Parsing Rules for Querying Meals:**
- "tonight" / "today": Get current day name from `node calendar/calendar.js now`, find matching line in this-week.md
- "tomorrow": Get current day name from `node calendar/calendar.js now`, compute next day, find matching line
- "this week" / "show meals": Read and display all 7 lines

**4. Parsing Rules for Shopping List Generation:**
- Read all non-"No plan" entries from this-week.md
- For each meal, the agent should identify likely ingredients based on the meal name
- Present the ingredient list to the user for confirmation/editing before adding to shopping.md
- DO NOT auto-add to shopping.md without confirmation (meals are vague descriptions, not recipes)
- Format: show a proposed list, ask "Want me to add these to the shopping list?"

**5. Input/Output Examples (at least 6):**

Example 1 - Set single day:
Input: "set Thursday dinner to chicken parmesan"
Action: Read this-week.md, replace Thursday line with "- Thursday: Chicken parmesan", write back
Response: "Updated! Thursday dinner is now chicken parmesan"

Example 2 - Query tonight:
Input: "what's for dinner tonight"
Action: Run `node calendar/calendar.js now` to get day name (e.g., "Sunday"), read this-week.md, find "- Sunday: Leftover buffet"
Response: "Tonight's dinner: Leftover buffet"

Example 3 - No plan for today:
Input: "what's for dinner"
Action: Get day name, find "- Wednesday: No plan"
Response: "No dinner planned for tonight. Want me to set something?"

Example 4 - Set multiple days:
Input: "set meals for the week: Monday tacos, Tuesday pasta, Wednesday salmon"
Action: Update three lines in this-week.md, leave other days unchanged
Response: "Updated 3 meals! Monday: Tacos, Tuesday: Pasta, Wednesday: Salmon"

Example 5 - Shopping from meals:
Input: "make a shopping list from this week's meals"
Action: Read this-week.md, identify ingredients for each planned meal, present list
Response: "Based on this week's meals, here's what you might need: [ingredient list]. Want me to add these to the shopping list?"

Example 6 - Show full week:
Input: "show the meal plan"
Action: Read this-week.md, format all 7 days
Response: List all days with meals

**6. DO / DO NOT Table:**

| DO | DO NOT | WHY |
|---|---|---|
| Get today's day name from `node calendar/calendar.js now` | Use `date` command or guess the day | System clock is UTC; wrong day after 4 PM Pacific |
| Keep all 7 days in the file when updating | Delete unmentioned days | File must always have Mon-Sun entries |
| Ask for confirmation before adding meal ingredients to shopping | Auto-add ingredients to shopping.md | Meal names are vague; "tacos" could mean many different ingredients |
| Use full day names (Monday, Tuesday) | Use abbreviations (Mon, Tue) | Format header requires full day names |
| Capitalize meal description | Leave lowercase | Consistency with file format |

**7. Edge Cases:**
- "what's for dinner" when day is "No plan" -> suggest setting a meal
- "set dinner to pizza" with no day specified -> assume tonight (get from `node calendar/calendar.js now`)
- "clear Thursday" or "no dinner Thursday" -> set to "No plan"
  </action>
  <verify>
Verify the following in TOOLS.md:
- Meal Planning section exists between Quick Capture and Edge Cases sections
- Trigger phrase table present with at least 6 trigger patterns
- Parsing rules for set, query, and shopping generation present
- At least 6 input/output examples with **Input:**/**Action:**/**Response:** format
- DO/DO NOT table with at least 4 rows
- Edge cases documented
- All file references use correct path: `household/meals/this-week.md`
- `node calendar/calendar.js now` referenced for day name lookups (not `date` command, not `node calendar.js now`)
  </verify>
  <done>TOOLS.md has a complete Meal Planning section with trigger phrases, parsing rules, 6+ examples, DO/DO NOT table, and edge cases that a cheap LLM can follow without ambiguity.</done>
</task>

<task type="auto">
  <name>Task 2: Refine this-week.md format header for shopping generation</name>
  <files>household/meals/this-week.md</files>
  <action>
Update the HTML comment format header at the top of household/meals/this-week.md. The existing header is good but needs additions to support the shopping list generation workflow.

Add to the existing format header:
- A note about the "shopping from meals" workflow: "To generate shopping list: Read all days where meal is not 'No plan'. Agent identifies likely ingredients for each meal and proposes to user before adding to shopping.md."
- Clarify that meal descriptions should be specific enough for ingredient inference (e.g., "Chicken stir fry" not just "chicken")
- Add an example of a more detailed meal entry: "- Monday: Chicken stir fry with rice and vegetables"

Keep the existing rules and format intact. Only ADD to the header, do not remove existing content.

Also ensure the existing meal plan data stays exactly as-is (do not modify the actual meal entries).
  </action>
  <verify>
Verify in household/meals/this-week.md:
- HTML comment header still present and valid
- New shopping generation note appears in the header
- All 7 days (Monday-Sunday) still present with original meal data unchanged
- Header mentions "shopping" or "ingredient" workflow
  </verify>
  <done>this-week.md format header includes shopping list generation guidance so LLMs understand the meal-to-shopping workflow.</done>
</task>

</tasks>

<verification>
Phase 03 Plan 01 verification:
1. TOOLS.md contains "## Meal Planning" section
2. Section has trigger phrase table, parsing rules, examples, DO/DO NOT table
3. household/meals/this-week.md format header updated for shopping generation
4. All meal data preserved unchanged
5. File path references are consistent (household/meals/this-week.md)
6. Calendar CLI references use correct path: `node calendar/calendar.js now`
</verification>

<success_criteria>
- TOOLS.md Meal Planning section has 6+ trigger patterns, 6+ examples, DO/DO NOT table
- this-week.md format header includes shopping generation guidance
- All existing meal data is unchanged
- All calendar CLI references use `node calendar/calendar.js now` (correct path)
- A cheap LLM reading TOOLS.md can set meals, query tonight's dinner, and generate shopping lists
</success_criteria>

<output>
After completion, create `.planning/phases/03-meal-planning/03-01-SUMMARY.md`
</output>
