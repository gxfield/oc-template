---
phase: 06-daily-morning-briefing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - TOOLS.md
  - HEARTBEAT.md
autonomous: true

must_haves:
  truths:
    - "On-demand briefing includes a Meat Reminder section when tonight's dinner contains meat keywords"
    - "On-demand briefing includes a Recipe Inspiration section with 2-3 random recipes from peaceloveandlowcarb.com/feed/"
    - "Meat Reminder section is skipped entirely when no meat keywords found or no dinner planned"
    - "Recipe Inspiration section always appears in briefings"
    - "Agent sends morning briefing automatically during heartbeat polls between 7-10 AM Pacific"
    - "Automated morning briefing does not repeat if already sent today (dedup via heartbeat-state.json)"
  artifacts:
    - path: "TOOLS.md"
      provides: "Meat Reminder + Recipe Inspiration briefing sections, Automated Morning Briefing subsection"
      contains: "Meat Reminder"
    - path: "HEARTBEAT.md"
      provides: "Morning briefing heartbeat task with time window and dedup logic"
      contains: "morning briefing"
  key_links:
    - from: "TOOLS.md"
      to: "household/meals/this-week.md"
      via: "Meat keyword check against tonight's dinner"
      pattern: "chicken|beef|pork|salmon|steak|turkey|lamb|fish|shrimp"
    - from: "TOOLS.md"
      to: "peaceloveandlowcarb.com/feed/"
      via: "RSS feed fetch for recipe inspiration"
      pattern: "peaceloveandlowcarb.com/feed"
    - from: "HEARTBEAT.md"
      to: "memory/heartbeat-state.json"
      via: "Dedup check for lastMorningBriefing date"
      pattern: "lastMorningBriefing"
---

<objective>
Add two new briefing sections (Meat Reminder and Recipe Inspiration) to the existing briefing template in TOOLS.md, and configure HEARTBEAT.md with an automated morning briefing task.

Purpose: Extend the 5-section briefing to 7 sections for richer household awareness, and enable proactive morning briefings without user prompting.
Output: Updated TOOLS.md with enhanced briefing template + automated briefing subsection, updated HEARTBEAT.md with morning briefing task.
</objective>

<execution_context>
@/Users/greg/.claude/get-shit-done/workflows/execute-plan.md
@/Users/greg/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@TOOLS.md
@HEARTBEAT.md
@AGENTS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Meat Reminder and Recipe Inspiration sections to TOOLS.md briefing</name>
  <files>TOOLS.md</files>
  <action>
Modify the existing Briefing section in TOOLS.md (currently lines 192-315). Make these specific changes:

1. **Update the Data Assembly Steps** (currently lines 206-212): Change "5 sources" to "7 sources" and add two new numbered steps after step 5 (Bills):
   - Step 6: **Meat Reminder:** After getting tonight's dinner (step 4), check if the meal description contains any meat keyword: chicken, beef, pork, salmon, steak, turkey, lamb, fish, shrimp. Case-insensitive match. If match found, include meat reminder section. If no match or no dinner planned ("No plan"), skip entirely.
   - Step 7: **Recipe Inspiration:** Fetch RSS feed from `https://peaceloveandlowcarb.com/feed/`, extract 2-3 random recipe entries (title + link), format as bullet list.

2. **Update the Output Format Template** (currently lines 216-240): Add two new sections AFTER the Bills section:
   ```
   ü•© Dinner Prep
   Tonight's dinner is {meal} ‚Äî don't forget to take meat out of the freezer!
   {This section ONLY appears if meat keyword found in tonight's dinner. Skip entirely otherwise.}

   üç≥ Recipe Inspiration
   ‚Ä¢ {Recipe Title} ‚Äî {URL}
   ‚Ä¢ {Recipe Title} ‚Äî {URL}
   {Always show this section. Pick 2-3 random entries from the RSS feed.}
   ```

3. **Update the Input/Output Examples**: In Example 1 (full briefing with data, around lines 244-274), add the two new sections after Bills showing sample output. In Example 2 (empty sections, around lines 276-298), show Recipe Inspiration (always present) but NOT Meat Reminder (since "No dinner planned" means no meat check).

4. **Update the DO/DO NOT table** (around lines 300-309): Add two new rows:
   - DO: Check meat keywords case-insensitively against tonight's dinner description | DO NOT: Try to infer meat from meal names like "leftover" or "stir fry" without explicit keywords | WHY: Simple keyword match is reliable for cheap LLMs; inference is error-prone
   - DO: Fetch 2-3 random recipes from the RSS feed each time | DO NOT: Cache or repeat the same recipes | WHY: Variety keeps the section interesting

5. **Update the Edge Cases section** (around lines 311-314): Add:
   - "No dinner planned" or "No plan" for tonight: Skip Meat Reminder entirely (do not show section header)
   - Dinner has no meat keywords (e.g., "Pasta with marinara"): Skip Meat Reminder entirely
   - RSS feed unavailable: Show "Could not fetch recipes" instead of crashing

6. **Update counts**: Change all references to "5 sections" or "5 sources" to "7 sections" or "7 sources" throughout the Briefing subsection. Update the "Show all 5 sections" DO/DO NOT row: The original 5 sections plus Recipe Inspiration always show (6 always-shown). Meat Reminder only shows conditionally.

Per user decision: these new sections apply to ALL briefings (on-demand and automated), not just the automated one.
  </action>
  <verify>
Grep TOOLS.md for "Meat Reminder" -- should find section header and references.
Grep TOOLS.md for "Recipe Inspiration" -- should find section header and references.
Grep TOOLS.md for "peaceloveandlowcarb.com/feed" -- should find RSS feed URL.
Grep TOOLS.md for "7 sources" or "7 sections" -- should have replaced "5 sources/sections" references.
Count lines in Briefing section -- should be roughly 180-200 lines (up from ~122).
  </verify>
  <done>
TOOLS.md Briefing section includes Meat Reminder (conditional, keyword-based) and Recipe Inspiration (always shown, RSS-based) sections with data assembly steps, output template, examples, DO/DO NOT rules, and edge cases. All "5 sources" references updated to 7.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add automated morning briefing to HEARTBEAT.md and TOOLS.md</name>
  <files>HEARTBEAT.md, TOOLS.md</files>
  <action>
**HEARTBEAT.md changes:**

Replace the current empty HEARTBEAT.md content with a morning briefing task. The file should contain:

```markdown
# HEARTBEAT.md

## Morning Briefing (7-10 AM Pacific)

Check if it's between 7:00 AM and 10:00 AM Pacific time using `node calendar/calendar.js now`.

If YES and `memory/heartbeat-state.json` field `lastMorningBriefing` is NOT today's date:
1. Run the full briefing (all 7 sections from TOOLS.md Briefing section)
2. Send the briefing to the user
3. Update `memory/heartbeat-state.json`: set `lastMorningBriefing` to today's Pacific date (YYYY-MM-DD format)

If already sent today (lastMorningBriefing = today's date): Skip, reply HEARTBEAT_OK.
If outside 7-10 AM Pacific window: Skip this task, continue with other heartbeat checks.

### DO / DO NOT

| DO | DO NOT | WHY |
|---|---|---|
| Check time from `node calendar/calendar.js now` | Use `date` command for time check | System clock is UTC |
| Read `memory/heartbeat-state.json` for dedup | Send briefing every heartbeat | Would spam user multiple times per morning |
| Create `memory/heartbeat-state.json` if it doesn't exist | Crash if file is missing | First run won't have the file yet |
| Send the full 7-section briefing | Send a shortened version | Morning briefing should be comprehensive |
```

**TOOLS.md changes:**

Add an "Automated Morning Briefing" subsection inside the existing Briefing section, right after the Edge Cases subsection (around line ~320 after Task 1's edits). Content:

```markdown
#### Automated Morning Briefing

The agent sends the briefing proactively during heartbeat polls without the user asking.

**Timing:** Between 7:00 AM and 10:00 AM Pacific (checked via `node calendar/calendar.js now`)

**Dedup:** The agent tracks whether today's briefing has already been sent using `memory/heartbeat-state.json`:

```json
{
  "lastMorningBriefing": "2026-02-10"
}
```

**Workflow during heartbeat:**
1. Get current Pacific time from `node calendar/calendar.js now`
2. Check if hour is between 7 and 9 (inclusive, so 7:00-9:59 AM)
3. Read `memory/heartbeat-state.json` (create with empty object `{}` if missing)
4. If `lastMorningBriefing` equals today's date ‚Üí skip (already sent)
5. If not yet sent ‚Üí assemble full 7-section briefing (same as on-demand) and send to user
6. After sending ‚Üí update `lastMorningBriefing` to today's date in heartbeat-state.json

**DO / DO NOT:**

| DO | DO NOT | WHY |
|---|---|---|
| Check time with `node calendar/calendar.js now` | Use `date` command or JavaScript `new Date()` | UTC system clock gives wrong hour |
| Write `lastMorningBriefing` after sending | Write before sending | If send fails, dedup would prevent retry |
| Create heartbeat-state.json if missing | Assume file exists | First heartbeat won't have it |
| Use the same 7-section format as on-demand briefing | Create a different/shorter format | Consistency for user |
```

Note: The time window check uses hours 7-9 (7:00 AM through 9:59 AM) which covers the "7-10 AM" window per user decision.
  </action>
  <verify>
Grep HEARTBEAT.md for "Morning Briefing" -- should find the task header.
Grep HEARTBEAT.md for "lastMorningBriefing" -- should find dedup logic.
Grep HEARTBEAT.md for "7-10 AM" or "7:00 AM" -- should find time window.
Grep TOOLS.md for "Automated Morning Briefing" -- should find subsection header.
Grep TOOLS.md for "heartbeat-state.json" -- should find dedup documentation.
  </verify>
  <done>
HEARTBEAT.md contains a morning briefing task with 7-10 AM Pacific time window, dedup via heartbeat-state.json lastMorningBriefing field, and DO/DO NOT table. TOOLS.md contains an Automated Morning Briefing subsection documenting the timing, dedup workflow, and rules.
  </done>
</task>

</tasks>

<verification>
1. TOOLS.md Briefing section contains 7-section template (original 5 + Meat Reminder + Recipe Inspiration)
2. Meat Reminder section uses keyword matching against tonight's dinner
3. Recipe Inspiration section fetches from peaceloveandlowcarb.com/feed/
4. HEARTBEAT.md has morning briefing task with time window and dedup
5. TOOLS.md has Automated Morning Briefing subsection
6. All DO/DO NOT tables use `node calendar/calendar.js now` for time operations
</verification>

<success_criteria>
- TOOLS.md Briefing section expanded from 5 to 7 data sources with complete documentation
- Meat Reminder appears conditionally (only when meat keywords found in tonight's dinner)
- Recipe Inspiration always appears with 2-3 random RSS feed entries
- HEARTBEAT.md enables proactive morning briefing between 7-10 AM Pacific
- Dedup prevents duplicate briefings via heartbeat-state.json
- All new content follows existing DO/DO NOT and example patterns
</success_criteria>

<output>
After completion, create `.planning/phases/06-daily-morning-briefing/06-01-SUMMARY.md`
</output>
