---
phase: 06-daily-morning-briefing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - HEARTBEAT.md
  - TOOLS.md
autonomous: true

must_haves:
  truths:
    - "HEARTBEAT.md contains a morning briefing task that checks the time and sends the briefing if it is morning and one has not already been sent today"
    - "TOOLS.md documents the automated morning briefing: timing window, dedup logic, data sources, and suppression rules"
    - "The automated briefing uses the same 5-section format and data sources as the on-demand briefing from Phase 5"
  artifacts:
    - path: "HEARTBEAT.md"
      provides: "Morning briefing heartbeat task"
      contains: "morning briefing"
    - path: "TOOLS.md"
      provides: "Automated Morning Briefing documentation section"
      contains: "Automated Morning Briefing"
  key_links:
    - from: "HEARTBEAT.md"
      to: "TOOLS.md"
      via: "Reference to Briefing section for format and assembly steps"
      pattern: "TOOLS.md.*Briefing"
    - from: "HEARTBEAT.md"
      to: "memory/heartbeat-state.json"
      via: "Dedup tracking for last briefing date"
      pattern: "heartbeat-state"
---

<objective>
Configure the heartbeat system to automatically send a daily morning briefing and document the automated briefing workflow in TOOLS.md.

Purpose: Users currently must ask for a briefing. This plan makes the agent proactively send one each morning during heartbeat polls, so users wake up to a household summary without asking.

Output: HEARTBEAT.md with morning briefing task, TOOLS.md with automated briefing documentation section.
</objective>

<execution_context>
@/Users/greg/.claude/get-shit-done/workflows/execute-plan.md
@/Users/greg/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-briefing-system/05-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure HEARTBEAT.md with morning briefing task</name>
  <files>HEARTBEAT.md</files>
  <action>
Replace the empty HEARTBEAT.md with a morning briefing task. The task must instruct the agent to:

1. Check current Pacific time using `node calendar/calendar.js now`
2. If the time is between 7:00 AM and 10:00 AM Pacific AND `memory/heartbeat-state.json` does NOT have `lastMorningBriefing` set to today's date:
   - Assemble the full briefing following the exact same process documented in TOOLS.md Briefing section (5 data sources: calendar today, pending todos, shopping list, tonight's meal, bills due in 7 days)
   - Send the briefing to the user
   - Update `memory/heartbeat-state.json` to set `lastMorningBriefing` to today's Pacific date
3. If the time is outside 7-10 AM, or if today's briefing was already sent, skip (continue with other heartbeat checks)

Format the HEARTBEAT.md as a clear checklist with these rules:
- Keep it concise (heartbeat tasks should be small to limit token burn, per AGENTS.md guidance)
- Reference TOOLS.md Briefing section for the output format and assembly steps (do not duplicate the full template)
- Include the dedup check against heartbeat-state.json
- Include a note that the morning briefing window is 7-10 AM Pacific

Preserve the existing HTML comment at the top explaining that empty file = skip heartbeat. Add the task below it.
  </action>
  <verify>Read HEARTBEAT.md and confirm it contains: morning briefing task, time window (7-10 AM), dedup check against heartbeat-state.json, reference to TOOLS.md Briefing section</verify>
  <done>HEARTBEAT.md has a morning briefing task that will trigger during 7-10 AM Pacific heartbeats, checks dedup, and references TOOLS.md for format</done>
</task>

<task type="auto">
  <name>Task 2: Document Automated Morning Briefing in TOOLS.md</name>
  <files>TOOLS.md</files>
  <action>
Add an "Automated Morning Briefing" subsection inside the existing Briefing section in TOOLS.md (after the Edge Cases subsection, before the Help section at line 316). This section documents how the automated briefing works for LLMs that process heartbeat polls.

Include:

1. **Overview:** Brief explanation that the agent proactively sends a morning briefing during heartbeat polls without being asked. Same content as on-demand briefing.

2. **Timing Rules:**
   - Window: 7:00 AM - 10:00 AM Pacific
   - Check: Compare current Pacific time (from `node calendar/calendar.js now`) to window
   - Outside window: Skip, do not send

3. **Dedup Logic:**
   - Before sending, check `memory/heartbeat-state.json` for `lastMorningBriefing` field
   - If it equals today's Pacific date, skip (already sent today)
   - After sending, update the field to today's date
   - If the file does not exist, create it with `{ "lastMorningBriefing": "YYYY-MM-DD" }`

4. **Assembly:** Same 5-step process as on-demand briefing (reference "Data Assembly Steps" above, do not duplicate)

5. **DO / DO NOT table:**
   - DO: Check time with `node calendar/calendar.js now` before sending
   - DO: Check heartbeat-state.json for dedup before sending
   - DO: Use same format as on-demand briefing (emoji headers, bullet lists)
   - DO NOT: Send briefing outside 7-10 AM window
   - DO NOT: Send if today's briefing was already sent (dedup)
   - DO NOT: Use `date` command to check time (UTC, not Pacific)

Keep the section concise (30-50 lines). The full briefing format is already documented above; this section only adds the automation-specific rules.
  </action>
  <verify>Read TOOLS.md and confirm the Automated Morning Briefing subsection exists with timing rules, dedup logic, and DO/DO NOT table. Verify it is placed inside the Briefing section before the Help section.</verify>
  <done>TOOLS.md has an Automated Morning Briefing subsection with timing window (7-10 AM), dedup via heartbeat-state.json, and DO/DO NOT table</done>
</task>

</tasks>

<verification>
- HEARTBEAT.md is no longer empty and contains a morning briefing task
- TOOLS.md Briefing section includes Automated Morning Briefing subsection
- Both files reference the same timing window (7-10 AM Pacific)
- Both files reference the same dedup mechanism (heartbeat-state.json lastMorningBriefing)
- HEARTBEAT.md points to TOOLS.md for full format details (no duplication)
</verification>

<success_criteria>
- HEARTBEAT.md contains a concise morning briefing task with time check and dedup
- TOOLS.md documents the automated briefing with timing, dedup, and DO/DO NOT rules
- An agent processing a heartbeat poll between 7-10 AM Pacific would know to send a briefing and how to avoid duplicates
</success_criteria>

<output>
After completion, create `.planning/phases/06-daily-morning-briefing/06-01-SUMMARY.md`
</output>
